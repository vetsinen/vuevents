<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>vuevents</title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/style.css" />
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="vue.js"></script>
    <script src="vue-resource"></script>
</head>
<body>
<div id="app">
    <header>
        <nav class="navbar navbar-dark bg-dark fixed-top">
            <a class="navbar-brand" href="#">Events</a>
            <input type="date" id="date" name="date" v-model="datestr" min="2018-01-01" max="2018-12-31"/>
        </nav>
    </header>
    <div class="la-square-jelly-box la-2x loader" v-if="!events.length">
        <div></div>
        <div></div>
    </div>
    <div class="events container" v-else>
        <div class="buttons-shell row">
            <div class="col-md-12 col-xs-12">
                <button v-on:click="prev" class="btn btn-dark prev">Prev</button>
                <button v-on:click="next" class="btn btn-dark next">Next</button>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 col-xs-12">
                <div class="list-group">
                    <div class="list-group-item list-group-item-action flex-column align-items-start" v-for="event in events">
                        <div class="item-header d-flex w-100 justify-content-between">
                            <h4 class="mb-1"><a :href="'https://www.facebook.com/events/'+event.id" target="_blank" v-html="event.name"></a></h4>
                            <h4 v-if="event.start_time">{{event.start_time.substring(11,16)}}</h4>
                        </div>
                        <div v-html="event.description" class="item-description mb-1 collapse" :id="'event_'+event.id"></div>
                        <button :data-target="'#event_'+event.id" data-toggle="collapse" class="show-more collapsed btn btn-dark"></button>
                        <button v-on:click="like(event.id)" class="btn btn-dark">Like</button>
                        <button v-on:click="stop(event.id)" class="btn btn-dark">Stop</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="buttons-shell row">
            <div class="col-md-12 col-xs-12">
                <button v-on:click="prev" class="btn btn-dark prev">Prev</button>
                <button v-on:click="next" class="btn btn-dark next">Next</button>
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="container-fluid">
            <span class="text-muted">For guide and {{ message }} on how to</span>
        </div>
    </footer>
</div>
<script>
    let app = new Vue({
        el: '#app',
        data: {
            message: 'Hello Vue!',
            datestr: utc = new Date().toJSON().slice(0, 10),
            users: [],
            events: [
//              {id: 2423423, name: 'party'},
//              {id: 5345463, name: 'conference'},
//              {id: 47363433, name: 'concert'}
            ]
        },
        created: function () {
            console.log('created vue');
            //this.$http.get('http://jsonplaceholder.typicode.com/users').then(response => {
            //this.$http.get('https://damp-peak-30854.herokuapp.com/events').then(response => {
                // get body data
                //this.events = response.body;
            //}, response => {
                // error callback
            //});
            this.getevents();
        },
        methods: {
            selected: function (id) {
                console.log(id);
            },
            getevents: function () {
                var self = this;
                this.$http.get('https://damp-peak-30854.herokuapp.com/events/'+this.datestr).then(response => {
                    self.events = response.body;
                }, response => {
                    // error callback
                });
            },
            next: function () {
                var day = new Date(this.datestr);
                var nextDay = new Date();
                nextDay.setDate(day.getDate()+1);
                this.datestr = nextDay.toJSON().slice(0, 10)
            },
            prev: function () {
                var day = new Date(this.datestr);
                var nextDay = new Date();
                nextDay.setDate(day.getDate()-1);
                this.datestr = nextDay.toJSON().slice(0, 10)
            },
            like: function (id) {
                console.log(id);
            },
            evbar: function () {
            }
        },
        watch: {
            datestr: function () {
                this.getevents();
            }
        }
    })
</script>
</body>
</html>